local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

local isMobile = UserInputService.TouchEnabled
local isPC = UserInputService.MouseEnabled

local savedKey = ""

local buttonSize = isMobile and UDim2.new(0, 80, 0, 80) or UDim2.new(0, 60, 0, 60)
local windowSize = isMobile and UDim2.new(0, 400, 0, 250) or UDim2.new(0, 350, 0, 200)
local panelSize = isMobile and UDim2.new(0, 350, 0, 450) or UDim2.new(0, 320, 0, 400)

local neonBlue = Color3.fromRGB(0, 150, 255)
local neonGreen = Color3.fromRGB(0, 255, 150)
local neonPink = Color3.fromRGB(255, 0, 150)
local neonPurple = Color3.fromRGB(180, 0, 255)
local white = Color3.fromRGB(255, 255, 255)
local black = Color3.fromRGB(0, 0, 0)
local lightGray = Color3.fromRGB(240, 240, 240)
local mediumGray = Color3.fromRGB(180, 180, 180)
local darkGray = Color3.fromRGB(100, 100, 100)

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MrMIXAILLUltimate"
screenGui.Parent = game:GetService("CoreGui")

local function makeDraggable(gui)
    local frame = gui:FindFirstChildOfClass("Frame") or gui
    local dragging = false
    local dragInput, dragStart, startPos
    
    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

local mainButton = Instance.new("TextButton")
mainButton.Name = "MainButton"
mainButton.Size = buttonSize
mainButton.Position = UDim2.new(0.5, -40, 0.5, -40)
mainButton.BackgroundColor3 = lightGray
mainButton.Text = ""
mainButton.BorderSizePixel = 0
mainButton.ZIndex = 10
mainButton.AutoButtonColor = false

local buttonStroke = Instance.new("UIStroke")
buttonStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
buttonStroke.Color = neonBlue
buttonStroke.Thickness = 3
buttonStroke.Parent = mainButton

local buttonGlow = Instance.new("UIGradient")
buttonGlow.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, neonBlue),
    ColorSequenceKeypoint.new(0.5, neonGreen),
    ColorSequenceKeypoint.new(1, neonBlue)
})
buttonGlow.Rotation = 45
buttonGlow.Parent = buttonStroke

local letterM = Instance.new("TextLabel")
letterM.Name = "LetterM"
letterM.Size = UDim2.new(0, isMobile and 40 or 30, 0, isMobile and 50 or 40)
letterM.Position = UDim2.new(0.5, isMobile and -20 or -15, 0.5, isMobile and -25 or -20)
letterM.BackgroundTransparency = 1
letterM.Text = "M"
letterM.TextColor3 = neonBlue
letterM.TextScaled = true
letterM.Font = Enum.Font.SciFi
letterM.TextStrokeTransparency = 0
letterM.TextStrokeColor3 = neonBlue
letterM.Parent = mainButton

mainButton.Parent = screenGui
makeDraggable(mainButton)

local keyWindow = Instance.new("Frame")
keyWindow.Name = "KeyWindow"
keyWindow.Size = windowSize
keyWindow.Position = UDim2.new(0.5, -200, 0.5, -125)
keyWindow.BackgroundColor3 = lightGray
keyWindow.BackgroundTransparency = 0
keyWindow.Visible = false
keyWindow.ZIndex = 20

local keyWindowStroke = Instance.new("UIStroke")
keyWindowStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
keyWindowStroke.Color = neonBlue
keyWindowStroke.Thickness = 3
keyWindowStroke.Parent = keyWindow

local keyCorner = Instance.new("UICorner")
keyCorner.CornerRadius = UDim.new(0, 12)
keyCorner.Parent = keyWindow

local title = Instance.new("TextLabel")
title.Name = "Title"
title.Size = UDim2.new(1, 0, 0, 50)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundColor3 = mediumGray
title.TextColor3 = neonBlue
title.Text = "MrMIXAILL ULTIMATE"
title.TextScaled = true
title.Font = Enum.Font.SciFi
title.TextStrokeTransparency = 0
title.TextStrokeColor3 = neonBlue
title.Parent = keyWindow

local keyInput = Instance.new("TextBox")
keyInput.Name = "KeyInput"
keyInput.Size = UDim2.new(0.8, 0, 0, isMobile and 50 or 40)
keyInput.Position = UDim2.new(0.1, 0, 0.3, 0)
keyInput.BackgroundColor3 = mediumGray
keyInput.TextColor3 = black
keyInput.PlaceholderText = "Введите ключ..."
keyInput.PlaceholderColor3 = darkGray
keyInput.Text = ""
keyInput.ClearTextOnFocus = false
keyInput.TextScaled = true
keyInput.Font = Enum.Font.SciFi
keyInput.Parent = keyWindow

local inputCorner = Instance.new("UICorner")
inputCorner.CornerRadius = UDim.new(0, 8)
inputCorner.Parent = keyInput

local getKeyButton = Instance.new("TextButton")
getKeyButton.Name = "GetKeyButton"
getKeyButton.Size = UDim2.new(0.8, 0, 0, isMobile and 50 or 40)
getKeyButton.Position = UDim2.new(0.1, 0, 0.6, 0)
getKeyButton.BackgroundColor3 = mediumGray
getKeyButton.TextColor3 = black
getKeyButton.Text = "ПОЛУЧИТЬ КЛЮЧ"
getKeyButton.Font = Enum.Font.SciFi
getKeyButton.TextScaled = true
getKeyButton.AutoButtonColor = true
getKeyButton.Parent = keyWindow

local getKeyCorner = Instance.new("UICorner")
getKeyCorner.CornerRadius = UDim.new(0, 8)
getKeyCorner.Parent = getKeyButton

local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, isMobile and 40 or 30, 0, isMobile and 40 or 30)
closeButton.Position = UDim2.new(1, isMobile and -45 or -35, 0, 5)
closeButton.BackgroundColor3 = Color3.new(1, 0, 0)
closeButton.TextColor3 = white
closeButton.Text = "X"
closeButton.Font = Enum.Font.SciFi
closeButton.TextScaled = true
closeButton.Parent = keyWindow

local minimizeButton = Instance.new("TextButton")
minimizeButton.Name = "MinimizeButton"
minimizeButton.Size = UDim2.new(0, isMobile and 40 or 30, 0, isMobile and 40 or 30)
minimizeButton.Position = UDim2.new(1, isMobile and -90 or -70, 0, 5)
minimizeButton.BackgroundColor3 = Color3.new(1, 1, 0)
minimizeButton.TextColor3 = black
minimizeButton.Text = "_"
minimizeButton.Font = Enum.Font.SciFi
minimizeButton.TextScaled = true
minimizeButton.Parent = keyWindow

keyWindow.Parent = screenGui
makeDraggable(keyWindow)

local scriptPanel = Instance.new("Frame")
scriptPanel.Name = "ScriptPanel"
scriptPanel.Size = panelSize
scriptPanel.Position = UDim2.new(0.5, -175, 0.5, -200)
scriptPanel.BackgroundColor3 = lightGray
scriptPanel.BackgroundTransparency = 0
scriptPanel.Visible = false
scriptPanel.ZIndex = 30

local scriptPanelStroke = Instance.new("UIStroke")
scriptPanelStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
scriptPanelStroke.Color = neonBlue
scriptPanelStroke.Thickness = 3
scriptPanelStroke.Parent = scriptPanel

local scriptCorner = Instance.new("UICorner")
scriptCorner.CornerRadius = UDim.new(0, 12)
scriptCorner.Parent = scriptPanel

local panelTitle = Instance.new("TextLabel")
panelTitle.Name = "PanelTitle"
panelTitle.Size = UDim2.new(1, 0, 0, 50)
panelTitle.Position = UDim2.new(0, 0, 0, 0)
panelTitle.BackgroundColor3 = mediumGray
panelTitle.TextColor3 = neonBlue
panelTitle.Text = "MrMIXAILL ULTIMATE SCRIPTS"
panelTitle.TextScaled = true
panelTitle.Font = Enum.Font.SciFi
panelTitle.TextStrokeTransparency = 0
panelTitle.TextStrokeColor3 = neonBlue
panelTitle.Parent = scriptPanel

local panelCloseButton = Instance.new("TextButton")
panelCloseButton.Name = "PanelCloseButton"
panelCloseButton.Size = UDim2.new(0, isMobile and 40 or 30, 0, isMobile and 40 or 30)
panelCloseButton.Position = UDim2.new(1, isMobile and -45 or -35, 0, 5)
panelCloseButton.BackgroundColor3 = Color3.new(1, 0, 0)
panelCloseButton.TextColor3 = white
panelCloseButton.Text = "X"
panelCloseButton.Font = Enum.Font.SciFi
panelCloseButton.TextScaled = true
panelCloseButton.Parent = scriptPanel

local panelMinimizeButton = Instance.new("TextButton")
panelMinimizeButton.Name = "PanelMinimizeButton"
panelMinimizeButton.Size = UDim2.new(0, isMobile and 40 or 30, 0, isMobile and 40 or 30)
panelMinimizeButton.Position = UDim2.new(1, isMobile and -90 or -70, 0, 5)
panelMinimizeButton.BackgroundColor3 = Color3.new(1, 1, 0)
panelMinimizeButton.TextColor3 = black
panelMinimizeButton.Text = "_"
panelMinimizeButton.Font = Enum.Font.SciFi
panelMinimizeButton.TextScaled = true
panelMinimizeButton.Parent = scriptPanel

local buttonStates = {}
local activeGUIs = {}
local originalSpeed = 16
local originalJumpPower = 50

local functions = {
    "FLY", "SPEED", "NOCLIP", "INF JUMP", "ANTI AFK", 
    "ESP", "XRAY", "NO CLIP", "SPEED HACK", "JUMP HACK",
    "GOD MODE", "INVISIBLE", "FULL BRIGHT", "NO FOG", "FLY HACK V2"
}

local function createFlyGUI()
    if activeGUIs.Fly then
        activeGUIs.Fly:Destroy()
        activeGUIs.Fly = nil
        return
    end

    local flyGUI = Instance.new("ScreenGui")
    flyGUI.Name = "FlyGUI"
    flyGUI.Parent = game:GetService("CoreGui")
    
    local frame = Instance.new("Frame")
    frame.Parent = flyGUI
    frame.BackgroundColor3 = lightGray
    frame.BorderColor3 = neonBlue
    frame.Position = UDim2.new(0.1, 0, 0.3, 0)
    frame.Size = UDim2.new(0, 250, 0, 150)
    frame.Active = true
    frame.Draggable = true

    local title = Instance.new("TextLabel")
    title.Parent = frame
    title.Size = UDim2.new(1, 0, 0, 40)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundColor3 = mediumGray
    title.TextColor3 = neonBlue
    title.Text = "MrM FLY ULTIMATE"
    title.TextScaled = true
    title.Font = Enum.Font.SciFi

    local closeButton = Instance.new("TextButton")
    closeButton.Parent = frame
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -35, 0, 5)
    closeButton.BackgroundColor3 = Color3.new(1, 0, 0)
    closeButton.TextColor3 = white
    closeButton.Text = "X"
    closeButton.TextScaled = true
    closeButton.MouseButton1Click:Connect(function()
        flyGUI:Destroy()
        activeGUIs.Fly = nil
    end)

    activeGUIs.Fly = flyGUI
    makeDraggable(flyGUI)
end

local function toggleFly()
    if buttonStates["FLY"] then
        buttonStates["FLY"] = false
        if activeGUIs.Fly then
            activeGUIs.Fly:Destroy()
            activeGUIs.Fly = nil
        end
    else
        buttonStates["FLY"] = true
        createFlyGUI()
    end
end

local function toggleSpeed()
    if buttonStates["SPEED"] then
        buttonStates["SPEED"] = false
        local character = player.Character
        if character and character:FindFirstChildWhichIsA("Humanoid") then
            character:FindFirstChildWhichIsA("Humanoid").WalkSpeed = originalSpeed
        end
    else
        buttonStates["SPEED"] = true
        local character = player.Character
        if character and character:FindFirstChildWhichIsA("Humanoid") then
            originalSpeed = character:FindFirstChildWhichIsA("Humanoid").WalkSpeed
            character:FindFirstChildWhichIsA("Humanoid").WalkSpeed = 100
        end
    end
end

local function toggleNoclip()
    if buttonStates["NOCLIP"] then
        buttonStates["NOCLIP"] = false
    else
        buttonStates["NOCLIP"] = true
        local noclipConnection
        noclipConnection = RunService.Stepped:Connect(function()
            if buttonStates["NOCLIP"] and player.Character then
                for _, part in pairs(player.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            else
                if noclipConnection then
                    noclipConnection:Disconnect()
                end
            end
        end)
    end
end

local function toggleInfJump()
    if buttonStates["INF JUMP"] then
        buttonStates["INF JUMP"] = false
    else
        buttonStates["INF JUMP"] = true
        local connection
        connection = UserInputService.JumpRequest:Connect(function()
            if buttonStates["INF JUMP"] and player.Character then
                local humanoid = player.Character:FindFirstChildWhichIsA("Humanoid")
                if humanoid then
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end
        end)
    end
end

local function toggleAntiAFK()
    if buttonStates["ANTI AFK"] then
        buttonStates["ANTI AFK"] = false
    else
        buttonStates["ANTI AFK"] = true
        local virtualUser = game:GetService("VirtualUser")
        game:GetService("Players").LocalPlayer.Idled:Connect(function()
            if buttonStates["ANTI AFK"] then
                virtualUser:Button2Down(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
                wait(1)
                virtualUser:Button2Up(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
            end
        end)
    end
end

local function toggleESP()
    if buttonStates["ESP"] then
        buttonStates["ESP"] = false
    else
        buttonStates["ESP"] = true
    end
end

local function toggleXray()
    if buttonStates["XRAY"] then
        buttonStates["XRAY"] = false
        for _, part in pairs(workspace:GetDescendants()) do
            if part:IsA("BasePart") and part.Transparency == 0.5 then
                part.Transparency = 0
            end
        end
    else
        buttonStates["XRAY"] = true
        for _, part in pairs(workspace:GetDescendants()) do
            if part:IsA("BasePart") then
                part.Transparency = 0.5
            end
        end
    end
end

local function toggleGodMode()
    if buttonStates["GOD MODE"] then
        buttonStates["GOD MODE"] = false
    else
        buttonStates["GOD MODE"] = true
    end
end

local function toggleInvisible()
    if buttonStates["INVISIBLE"] then
        buttonStates["INVISIBLE"] = false
        if player.Character then
            for _, part in pairs(player.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.Transparency = 0
                end
            end
        end
    else
        buttonStates["INVISIBLE"] = true
        if player.Character then
            for _, part in pairs(player.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.Transparency = 1
                end
            end
        end
    end
end

local function toggleFullBright()
    if buttonStates["FULL BRIGHT"] then
        buttonStates["FULL BRIGHT"] = false
        game:GetService("Lighting").GlobalShadows = true
    else
        buttonStates["FULL BRIGHT"] = true
        game:GetService("Lighting").GlobalShadows = false
    end
end

local function toggleNoFog()
    if buttonStates["NO FOG"] then
        buttonStates["NO FOG"] = false
        game:GetService("Lighting").FogEnd = 100000
    else
        buttonStates["NO FOG"] = true
        game:GetService("Lighting").FogEnd = 999999
    end
end

local function toggleFlyHackV2()
    if buttonStates["FLY HACK V2"] then
        buttonStates["FLY HACK V2"] = false
    else
        buttonStates["FLY HACK V2"] = true
    end
end

for i, funcName in ipairs(functions) do
    local button = Instance.new("TextButton")
    button.Name = funcName
    button.Size = UDim2.new(0.8, 0, 0, isMobile and 35 or 30)
    button.Position = UDim2.new(0.1, 0, 0.12 + (i * 0.08), 0)
    button.BackgroundColor3 = mediumGray
    button.TextColor3 = black
    button.Text = funcName
    button.Font = Enum.Font.SciFi
    button.TextScaled = true
    button.AutoButtonColor = true
    button.Parent = scriptPanel
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = button
    
    buttonStates[funcName] = false
    
    button.MouseButton1Click:Connect(function()
        if funcName == "FLY" then toggleFly()
        elseif funcName == "SPEED" then toggleSpeed()
        elseif funcName == "NOCLIP" then toggleNoclip()
        elseif funcName == "INF JUMP" then toggleInfJump()
        elseif funcName == "ANTI AFK" then toggleAntiAFK()
        elseif funcName == "ESP" then toggleESP()
        elseif funcName == "XRAY" then toggleXray()
        elseif funcName == "GOD MODE" then toggleGodMode()
        elseif funcName == "INVISIBLE" then toggleInvisible()
        elseif funcName == "FULL BRIGHT" then toggleFullBright()
        elseif funcName == "NO FOG" then toggleNoFog()
        elseif funcName == "FLY HACK V2" then toggleFlyHackV2()
        end
        
        buttonStates[funcName] = not buttonStates[funcName]
        if buttonStates[funcName] then
            button.BackgroundColor3 = neonGreen
            button.TextColor3 = black
        else
            button.BackgroundColor3 = mediumGray
            button.TextColor3 = black
        end
    end)
end

scriptPanel.Parent = screenGui
makeDraggable(scriptPanel)

mainButton.MouseButton1Click:Connect(function()
    if savedKey == "9WSAD9mSCRIPTassets_thisISkey" then
        scriptPanel.Visible = true
        keyWindow.Visible = false
        mainButton.Visible = false
    else
        keyWindow.Visible = true
        mainButton.Visible = false
    end
end)

local function copyToClipboard(text)
    if isPC and setclipboard then
        setclipboard(text)
    else
        print("Ссылка для копирования: " .. text)
    end
end

getKeyButton.MouseButton1Click:Connect(function()
    copyToClipboard("https://link-hub.net/1405711/zEq7dPusRQtx")
end)

keyInput.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        if keyInput.Text == "9WSAD9mSCRIPTassets_thisISkey" then
            savedKey = keyInput.Text
            keyWindow.Visible = false
            scriptPanel.Visible = true
            mainButton.Visible = false
        else
            keyInput.Text = ""
            keyInput.PlaceholderText = "Неверный ключ! Попробуйте снова"
        end
    end
end)

closeButton.MouseButton1Click:Connect(function() screenGui:Destroy() end)
panelCloseButton.MouseButton1Click:Connect(function() screenGui:Destroy() end)

minimizeButton.MouseButton1Click:Connect(function()
    keyWindow.Visible = false
    mainButton.Visible = true
end)

panelMinimizeButton.MouseButton1Click:Connect(function()
    scriptPanel.Visible = false
    mainButton.Visible = true
end)

mainButton.Visible = true

while true do
    for _, button in pairs(scriptPanel:GetChildren()) do
        if button:IsA("TextButton") and buttonStates[button.Name] then
            local r = math.sin(tick() * 2 + _ * 0.5) * 0.5 + 0.5
            local g = math.sin(tick() * 2 + _ * 0.5 + 2) * 0.5 + 0.5
            local b = math.sin(tick() * 2 + _ * 0.5 + 4) * 0.5 + 0.5
            button.BackgroundColor3 = Color3.new(r, g, b)
        end
    end
    wait(0.1)
end
